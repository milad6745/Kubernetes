

در Kubernetes، **سیاست‌های ریستارت (Restart Policies)** مشخص می‌کنند که چه زمانی یک پاد (Pod) یا کانتینرهای داخل آن باید ریستارت شوند. این سیاست‌ها معمولاً در **مانفیست پاد** (Pod Manifest) یا منابع مشابه مانند Job یا CronJob تعریف می‌شوند. سه نوع سیاست ریستارت وجود دارد:

---

### 1. **Always**
- **رفتار:** همیشه کانتینرهای پاد را در صورت توقف (Crash یا Exit) ریستارت می‌کند.
- **مناسب برای:** پادهایی که سرویس‌های طولانی‌مدت ارائه می‌دهند، مانند سرویس‌های وب.
- **پیش‌فرض:** اگر سیاست ریستارت مشخص نشود، Kubernetes به صورت پیش‌فرض از این سیاست استفاده می‌کند.
- **استفاده در منابع:** معمولاً برای **Deployment** یا **ReplicaSet**.

---

### 2. **OnFailure**
- **رفتار:** تنها در صورتی کانتینر ریستارت می‌شود که به دلیل یک خطای غیر صفر (non-zero exit code) متوقف شده باشد.
- **مناسب برای:** پردازش‌های کوتاه‌مدت که باید در صورت بروز خطا دوباره اجرا شوند، مانند پردازش داده‌ها.
- **استفاده در منابع:** معمولاً برای **Job** یا **CronJob**.

---

### 3. **Never**
- **رفتار:** هیچ‌گاه کانتینر را ریستارت نمی‌کند، حتی اگر به دلیل خطا متوقف شود.
- **مناسب برای:** مواقعی که نیاز به مشاهده و بررسی خروجی خطا دارید یا اجرای یک‌باره‌ای مدنظر است.
- **استفاده در منابع:** به ندرت استفاده می‌شود، اما در برخی تست‌ها یا اسکریپت‌های خاص ممکن است مفید باشد.

---

### کجا تنظیم می‌شود؟
این سیاست‌ها در مشخصات یک پاد یا منابع مشابه در فیلد `restartPolicy` تنظیم می‌شوند. مثلاً:

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: example-pod
spec:
  containers:
  - name: example-container
    image: nginx
  restartPolicy: OnFailure
```

---



سؤال خیلی خوبی پرسیدی! 🙌  
تفاوت بین `restart: Always` و `restart: OnFailure` (و بقیه حالات) توی Kubernetes خیلی مهمه مخصوصاً وقتی داری Pod یا Job تعریف می‌کنی.

---

## 🔁 فرق بین `restartPolicy` ها در Kubernetes

در YAML مربوط به یک **Pod** یا **Job**، می‌تونی مشخص کنی که رفتار پاد در صورت **خروج (exit)** کانتینر چطور باشه.

### 🔹 حالت‌ها:

| مقدار | توضیح |
|-------|--------|
| `Always` | همیشه کانتینر ری‌استارت می‌شه، چه با موفقیت (`exit 0`) خارج بشه چه با خطا (`exit 1`) – پیش‌فرض در **Deployment**ها |
| `OnFailure` | فقط وقتی ری‌استارت می‌شه که کانتینر با **خطا خارج شده باشه** (`exit code != 0`) |
| `Never` | هیچ وقت ری‌استارت نمی‌شه، حتی اگر با خطا خارج بشه |

---

### 📘 مثال کاربردی:

#### ✅ `restartPolicy: Always`
برای سرویس‌هایی مثل وب‌سرور، Nginx، API، که باید همیشه بالا باشن.

```yaml
apiVersion: v1
kind: Pod
spec:
  containers:
  - name: app
    image: nginx
  restartPolicy: Always
```

#### ✅ `restartPolicy: OnFailure`
مناسب برای **Job**هایی که فقط یک‌بار باید اجرا بشن (مثلاً backup یا پردازش دیتا).

```yaml
apiVersion: batch/v1
kind: Job
spec:
  template:
    spec:
      containers:
      - name: job
        image: busybox
        command: ["sh", "-c", "exit 1"]
      restartPolicy: OnFailure
```

---

### 🧠 نکته مهم:

- توی **Deployment**، فقط `restartPolicy: Always` مجازه.
- توی **Job**ها معمولاً `OnFailure` یا `Never` استفاده می‌شه.

---

اگه بخوای تفاوت اینا رو توی عمل ببینی، می‌تونم برات یه مثال واقعی بنویسم که با `kubectl` تستش کنی. بگی بفرستم؟
