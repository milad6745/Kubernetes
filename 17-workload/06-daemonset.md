## DaemonSet

در کلاستر Kubernetes، **DaemonSet** یک نوع من منابع (resource) است که به شما این امکان را می‌دهد که یک پاد (Pod) را به طور خودکار روی هر نود (Node) در کلاستر اجرا کنید. به عبارت دیگر، وقتی شما یک DaemonSet ایجاد می‌کنید، Kubernetes مطمئن می‌شود که یک پاد از نوع مورد نظر شما روی هر نود در کلاستر اجرا می‌شود یا زمانی که نود جدیدی به کلاستر اضافه می‌شود، به صورت خودکار یک پاد جدید از آن نوع روی آن نود راه‌اندازی می‌شود.

### چرا از DaemonSet استفاده می‌کنیم؟
این ویژگی زمانی مفید است که شما نیاز دارید که یک برنامه خاص یا سرویس را روی تمام نودهای کلاستر خود اجرا کنید، مانند:

- **نظارت و مانیتورینگ**: شما می‌خواهید یک ابزار نظارتی مثل Prometheus یا Fluentd روی تمام نودها اجرا شود تا بتواند وضعیت کلاستر را رصد کند.
- **امنیت و آنتی‌ویروس**: شما ممکن است نیاز به اجرای یک ابزار امنیتی در هر نود کلاستر برای اسکن و شناسایی تهدیدات داشته باشید.
- **مدیریت لاگ‌ها**: یک پاد DaemonSet می‌تواند به طور خودکار لاگ‌های سیستم را جمع‌آوری کرده و به سیستم‌های ذخیره‌سازی ارسال کند.

### مثال از استفاده DaemonSet:
فرض کنید شما می‌خواهید یک پاد برای جمع‌آوری لاگ‌ها از هر نود اجرا کنید. در اینجا یک تعریف ساده برای یک DaemonSet آورده شده است که از Fluentd برای این کار استفاده می‌کند.

```yaml
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: fluentd-logging
  namespace: kube-system
spec:
  selector:
    matchLabels:
      app: fluentd
  template:
    metadata:
      labels:
        app: fluentd
    spec:
      containers:
        - name: fluentd
          image: fluent/fluentd:v1.12-1
          ports:
            - containerPort: 24224
```

در این مثال:
- یک **DaemonSet** به نام `fluentd-logging` ایجاد شده است که از تصویر `fluent/fluentd:v1.12-1` برای جمع‌آوری لاگ‌ها استفاده می‌کند.
- در بخش `selector`، مشخص شده است که DaemonSet باید روی پادهایی که برچسب `app: fluentd` دارند اجرا شود.
- در نهایت، وقتی این DaemonSet به اجرا در می‌آید، Kubernetes به طور خودکار یک پاد Fluentd روی هر نود در کلاستر راه‌اندازی می‌کند.

### نحوه عملکرد DaemonSet:
- وقتی DaemonSet به کلاستر اضافه می‌شود، Kubernetes یک پاد برای هر نودی که در کلاستر موجود است، ایجاد می‌کند.
- اگر نود جدیدی به کلاستر اضافه شود، Kubernetes به طور خودکار پاد DaemonSet را روی آن نود نیز اجرا می‌کند.
- اگر نودی از کلاستر حذف شود، پاد مربوط به آن نود نیز حذف می‌شود.

### برخی از کاربردهای رایج DaemonSet:
- **نظارت و لاگ‌برداری**: ابزارهایی مثل Fluentd، Logstash، Prometheus Node Exporter
- **مدیریت شبکه**: ابزارهایی برای جمع‌آوری و تحلیل داده‌های شبکه
- **امنیت**: ابزارهایی برای بررسی وضعیت امنیتی سیستم‌ها

### مواردی که باید در نظر بگیرید:
- DaemonSet‌ها معمولاً در namespaceهای سیستم (مثل `kube-system`) قرار می‌گیرند.
- می‌توانید برای محدود کردن منابع (CPU و Memory) و پیکربندی‌های دیگری مانند سیاست‌های تجزیه و تحلیل ترافیک یا امنیت، تنظیمات بیشتری را در `spec` DaemonSet قرار دهید.

### مزایا و معایب DaemonSet:
#### مزایا:
- **اتوماتیک و بدون نیاز به مدیریت دستی**: پادها به طور خودکار روی نودها ایجاد و حذف می‌شوند.
- **مناسب برای سرویس‌هایی که باید روی همه نودها اجرا شوند**: مانند ابزارهای مانیتورینگ، لاگ‌برداری، امنیت، و غیره.

#### معایب:
- **مصرف منابع**: اگر تعداد نودها زیاد باشد، DaemonSet ممکن است باعث مصرف زیاد منابع شود.
- **مدیریت پیچیده**: اگر تعداد زیادی DaemonSet داشته باشید، ممکن است نظارت و مدیریت آن‌ها پیچیده شود.

در کل، DaemonSet یکی از ابزارهای مفید و ضروری در Kubernetes است که به شما کمک می‌کند سرویس‌هایی که باید در سطح کلاستر اجرا شوند را به راحتی مدیریت کنید.
