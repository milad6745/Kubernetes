## nodeport And Cluster ip

در Kubernetes، یک **Cluster IP** یکی از انواع سرویس‌هایی است که برای دسترسی به مجموعه‌ای از پادها (Pods) از داخل خوشه (Cluster) استفاده می‌شود. وقتی یک سرویس از نوع `ClusterIP` ایجاد می‌شود، Kubernetes به‌طور خودکار یک آدرس IP داخلی به آن اختصاص می‌دهد که این IP فقط در داخل خوشه قابل دسترس است. این سرویس به عنوان یک نقطه ورودی ثابت برای مجموعه‌ای از پادها عمل می‌کند، به‌طوری‌که درخواست‌ها به آن IP به‌طور خودکار به یکی از پادهای مرتبط هدایت می‌شود.

### مزایا و موارد استفاده:
- **دسترسی داخلی**: سرویس‌های `ClusterIP` فقط از داخل خوشه قابل دسترس هستند، بنابراین برای سرویس‌هایی که فقط نیاز به دسترسی داخلی دارند (مثل سرویس‌های داخلی بین‌سرویس‌ها) مناسب هستند.
- **Load Balancing**: سرویس `ClusterIP` به‌طور خودکار درخواست‌ها را به صورت متوازن بین پادهای مرتبط با آن سرویس تقسیم می‌کند.
- **پایداری**: حتی اگر پادها به دلایلی مانند مقیاس‌بندی مجدد تغییر کنند، آدرس IP سرویس ثابت باقی می‌ماند.

### مثال:
فرض کنید یک سرویس `ClusterIP` برای یک اپلیکیشن وب ایجاد کرده‌اید که شامل چندین پاد است. درخواست‌هایی که به IP این سرویس ارسال می‌شوند، به صورت خودکار به یکی از پادهای اپلیکیشن هدایت می‌شوند، بدون اینکه کاربر نیازی به دانستن آدرس IP پادها داشته باشد.

### ساختار تعریف:
یک سرویس `ClusterIP` در یک فایل YAML به شکل زیر تعریف می‌شود:

```yaml
apiVersion: v1
kind: Service
metadata:
  name: my-service
spec:
  selector:
    app: my-app
  ports:
    - protocol: TCP
      port: 80
      targetPort: 9376
  type: ClusterIP
```

در Kubernetes، سرویس **NodePort** یکی از انواع سرویس‌ها است که امکان دسترسی به پادها (Pods) را از خارج از خوشه فراهم می‌کند. در این نوع سرویس، یک پورت خاص در هر نود (Node) از خوشه برای ارتباط با پادهای مربوط به آن سرویس باز می‌شود.

### ویژگی‌ها و کاربردهای NodePort:
- **دسترسی خارجی**: برخلاف `ClusterIP` که تنها از داخل خوشه قابل دسترس است، `NodePort` امکان دسترسی به سرویس از خارج از خوشه را فراهم می‌کند.
- **پورت مشخص در نودها**: Kubernetes یک پورت بین 30000 تا 32767 را در هر نود باز می‌کند که ترافیک ورودی از آن پورت به سرویس `NodePort` هدایت می‌شود. این ترافیک سپس به پادهای مرتبط با آن سرویس ارسال می‌شود.
- **Load Balancing**: همانند `ClusterIP`، `NodePort` نیز درخواست‌ها را به‌طور متوازن بین پادهای مرتبط تقسیم می‌کند.
- **کاربرد**: `NodePort` بیشتر برای دسترسی به سرویس‌ها از خارج از خوشه به صورت مستقیم و بدون نیاز به راه‌اندازی Load Balancer استفاده می‌شود. همچنین در محیط‌های توسعه و تست بسیار مفید است.

### ساختار تعریف:
یک سرویس `NodePort` در یک فایل YAML به شکل زیر تعریف می‌شود:

```yaml
apiVersion: v1
kind: Service
metadata:
  name: my-service
spec:
  selector:
    app: my-app
  ports:
    - protocol: TCP
      port: 80
      targetPort: 9376
      nodePort: 30007
  type: NodePort
```

در این تعریف:
- `selector` مشخص می‌کند که این سرویس به کدام پادها مرتبط است.
- `ports` پورت‌هایی که سرویس به آنها گوش می‌دهد را تعریف می‌کند:
  - `port` پورت داخلی سرویس است.
  - `targetPort` پورت درون پادها است.
  - `nodePort` پورت خارجی است که روی نودها باز می‌شود. اگر این فیلد مشخص نشود، Kubernetes به‌صورت خودکار یک پورت بین 30000 تا 32767 اختصاص می‌دهد.
- `type` نوع سرویس را مشخص می‌کند که در اینجا `NodePort` است.

### دسترسی به سرویس:
برای دسترسی به سرویس `NodePort` از خارج از خوشه، شما می‌توانید از آدرس IP هر یک از نودها به همراه شماره پورت `NodePort` استفاده کنید. به عنوان مثال، اگر نود شما IP `192.168.1.100` داشته باشد و پورت `NodePort` برابر `30007` باشد، می‌توانید با استفاده از آدرس `http://192.168.1.100:30007` به سرویس دسترسی پیدا کنید.

