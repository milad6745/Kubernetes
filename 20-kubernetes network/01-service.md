# Kubernetes Service 
چطور درخواست های کاربر را به داخل کلاسترمان هدایت کنیم . این موضوع به سرویس ختم میشود .

![image](https://github.com/milad6745/Kubernetes/assets/113288076/dd19462e-9d3c-4d5d-a600-ae77bb913aaa)


وظیفه آیپی دادن به پاد ها و سرویس ها با CNI است . مالتی هاست نتورکینگ با CNI هندل میشود .


سرویس در کوبرنتیز یه لاجیکی است که روی پادها قرار میگیرد و ما با آن لاجیک صحبت میکنیم .

 در این شکل ما یه Deployment أاریم که شامل 3 تا Replica آست و که بر روی pod هایش لیبل خورده و Selector آن بر روی سرویسش میباشد و از بیرون هر کسی دسترسی به pod ]ا را میخواهد سرویس آن را هندل میکند .


![image](https://github.com/milad6745/Kubernetes/assets/113288076/a9313c78-56d5-4781-88da-4abfb356a333)

سرویس و پاد از طریق لیبل و سلکتور به هم متصل میشوند .

# Serivce withou Selectors

بله، **Service بدون Selector** در Kubernetes می‌تواند هم برای **ترافیک ورودی به خوشه** (Cluster) و هم برای **ترافیک خروجی از خوشه** مورد استفاده قرار گیرد. در ادامه این دو سناریو را توضیح می‌دهم:

### 1. ترافیک **ورودی** به خوشه (Cluster)
در این حالت، شما از **Service بدون Selector** استفاده می‌کنید تا ترافیک ورودی (مثلاً از بیرون از خوشه) را به مقصدهای خاص در داخل خوشه هدایت کنید. این مقاصد می‌توانند شامل IP‌های داخلی خوشه یا حتی منابع خارجی باشند.

#### مثال:
فرض کنید ترافیکی از خارج از خوشه Kubernetes وارد می‌شود و شما می‌خواهید این ترافیک را به یک آدرس IP داخلی یا یک سرویس خاص هدایت کنید.

- ابتدا یک **Service** بدون Selector ایجاد می‌کنید که ترافیک ورودی را از طریق یک پورت مشخص دریافت کند:

   ```yaml
   apiVersion: v1
   kind: Service
   metadata:
     name: internal-service
   spec:
     ports:
       - port: 80
         targetPort: 8080
     externalIPs:
       - 192.168.1.10  # IP خارجی که ترافیک به آن هدایت می‌شود
   ```

- سپس **Endpoints** را برای هدایت ترافیک به مقصد مورد نظر تنظیم می‌کنید. این مقصد می‌تواند پادهای داخلی خوشه باشد یا یک IP خاص:

   ```yaml
   apiVersion: v1
   kind: Endpoints
   metadata:
     name: internal-service
   subsets:
     - addresses:
         - ip: 10.0.0.5  # IP مقصد داخل خوشه
       ports:
         - port: 8080
   ```

در این حالت، ترافیک ورودی به IP خارجی `192.168.1.10` به آدرس `10.0.0.5` داخل خوشه هدایت می‌شود.

### 2. ترافیک **خروجی** از خوشه (Cluster)
در این حالت، شما از **Service بدون Selector** استفاده می‌کنید تا ترافیک خروجی از خوشه را به یک مقصد خارجی (مثلاً یک دیتابیس، API یا سرویس دیگری که خارج از خوشه است) هدایت کنید.

#### مثال:
فرض کنید پادهای شما داخل خوشه Kubernetes قرار دارند و نیاز به اتصال به یک سرویس خارجی مانند یک دیتابیس MySQL که خارج از خوشه است، دارند.

- ابتدا یک **Service بدون Selector** برای ارتباط با سرویس خارجی ایجاد می‌کنید:

   ```yaml
   apiVersion: v1
   kind: Service
   metadata:
     name: external-database
   spec:
     ports:
       - port: 3306
         targetPort: 3306
     externalIPs:
       - 203.0.113.10  # IP سرویس دیتابیس خارجی
   ```

- شما همچنین می‌توانید از نوع سرویس `ExternalName` برای دسترسی به سرویس‌های DNS خارجی استفاده کنید:

   ```yaml
   apiVersion: v1
   kind: Service
   metadata:
     name: my-external-db
   spec:
     type: ExternalName
     externalName: db.example.com  # نام DNS سرویس خارجی
   ```

در این حالت، هر زمانی که پادهای داخلی به سرویس `external-database` یا `my-external-db` دسترسی پیدا کنند، ترافیک به سمت دیتابیس خارجی در آدرس IP یا DNS مشخص شده هدایت می‌شود.

### کاربردهای ترافیک ورودی و خروجی:

1. **ترافیک ورودی (از بیرون به داخل خوشه):**
   - هدایت ترافیک ورودی از بیرون به سرویس‌های داخل خوشه.
   - هدایت ترافیک به پادها یا منابع خاص بدون استفاده از Selector.
   - مدیریت دستی منابعی که به صورت خودکار توسط Kubernetes مدیریت نمی‌شوند.

2. **ترافیک خروجی (از داخل به خارج خوشه):**
   - اتصال پادهای داخل خوشه به سرویس‌های خارجی (مثل دیتابیس‌ها یا APIهای خارجی).
   - استفاده از DNS خارجی برای هدایت ترافیک به سرویس‌های خارج از خوشه.
   - فراهم کردن یک نقطه دسترسی ثابت برای منابع خارجی که از داخل خوشه به آن‌ها متصل می‌شوید.
