
---

<div dir="rtl" style="text-align: right; font-family: Vazir, Tahoma; line-height: 2;">

# kube-proxy در Kubernetes

`kube-proxy` 

یکی از اجزای اصلی در هر نود Kubernetes است که وظیفه‌ی مدیریت شبکه و مسیریابی ترافیک بین سرویس‌ها و پادها را بر عهده دارد. این مؤلفه با تنظیم و نگهداری قوانین شبکه‌ای، نقش کلیدی در ارتباط میان پادها و سرویس‌ها ایفا می‌کند.

---

### ✅ وظایف اصلی `kube-proxy`

1. **مسیریابی ترافیک سرویس‌ها**  
   `kube-proxy` تضمین می‌کند که ترافیک ورودی به یک سرویس (Service)، به درستی به یکی از پادهای پشت آن سرویس هدایت شود. سرویس‌ها به عنوان یک نقطه دسترسی واحد برای مجموعه‌ای از پادها عمل می‌کنند.

2. **تنظیم قوانین IPTables یا IPVS**  
   `kube-proxy` با تنظیم قوانین در `iptables` (یا `IPVS` در نسخه‌های جدیدتر) مشخص می‌کند که ترافیک ورودی به IP و پورت یک سرویس خاص، چگونه به پادهای مرتبط هدایت شود.

3. **توزیع بار (Load Balancing)**  
   با استفاده از الگوریتم‌هایی مانند round-robin، ترافیک بین پادهای پشت یک سرویس به صورت متعادل توزیع می‌شود. این کار به صورت پیش‌فرض انجام می‌گیرد، اما قابل تنظیم با سایر روش‌ها نیز هست.

---

### 🔁 ارتباط `kube-proxy` با `kubelet`

دو مؤلفه‌ی `kube-proxy` و `kubelet` به طور مستقل بر روی هر نود اجرا می‌شوند اما با همکاری یکدیگر عملکرد صحیح شبکه و پادها را تضمین می‌کنند:

- **`kubelet`**  
  مسئول اجرای پادها و حفظ ارتباط با کنترل‌پلین است. همچنین وضعیت پادها را به `kube-apiserver` گزارش می‌دهد.

- **`kube-proxy`**  
  مسئول تنظیم قوانین شبکه‌ای برای هدایت درست ترافیک بین پادها و سرویس‌ها است. این مؤلفه به‌صورت غیرمستقیم از اطلاعات فراهم‌شده توسط `kubelet` استفاده می‌کند.

> به عنوان مثال، اگر `kubelet` یک پاد جدید راه‌اندازی کند، `kube-proxy` از طریق API Server مطلع شده و قوانین شبکه را متناسب با این تغییر به‌روزرسانی می‌کند.

---

### 🎯 سایر وظایف و قابلیت‌ها

- **برقراری خدمات (Services):**  
  `kube-proxy` امکان ایجاد ارتباط بین کلاینت‌ها و پادهای پشت یک سرویس را فراهم می‌کند، چه در داخل کلاستر و چه از بیرون.

- **Load Balancing در لایه‌ی L4:**  
  توزیع ترافیک بر اساس IP و پورت (TCP/UDP) در لایه Transport انجام می‌شود.

- **نقشه‌برداری (Endpoint Mapping):**  
  `kube-proxy` اطلاعات مربوط به سرویس‌ها و پادهای متناظر را مدیریت و به‌روزرسانی می‌کند تا اطمینان حاصل شود که ترافیک همیشه به پادهای فعال هدایت می‌شود.

- **حالت‌های مختلف عملکرد (Proxy Modes):**  
  - `userspace`  
  - `iptables`  
  - `ipvs`  
  این حالت‌ها مشخص می‌کنند که `kube-proxy` چگونه ترافیک را پردازش و مسیریابی کند.

- **نقشه‌برداری بازگشتی (Reverse Mapping):**  
  با تغییر در پادها یا ReplicaSetها، اطلاعات نقشه‌برداری توسط `kube-proxy` به‌روزرسانی شده و ترافیک به مقصد جدید هدایت می‌شود.

---

### 🧩 جمع‌بندی

`kube-proxy` یکی از ارکان شبکه در معماری Kubernetes است که با ایجاد یک لایه‌ی شبکه‌ی مجازی، مدیریت ارتباطات میان کانتینرها و سرویس‌ها را بر عهده دارد. این مؤلفه با توزیع بار، تنظیم قوانین شبکه و فراهم کردن دسترسی‌های داخلی و خارجی به سرویس‌ها، نقش اساسی در عملکرد بهینه‌ی کلاستر دارد.


---

