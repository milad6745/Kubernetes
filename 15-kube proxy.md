
# kube proxy

 یکی از اجزای اصلی در هر نود Kubernetes است که وظیفه مدیریت شبکه و مسیریابی ترافیک شبکه بین سرویس‌ها و پادها را بر عهده دارد. این بخش به طور خاص در تنظیم و نگهداری قوانین شبکه‌ای که به ارتباط بین پادها و سرویس‌ها کمک می‌کنند، نقش دارد.

### وظایف `kube-proxy`:
1. **مسیریابی ترافیک سرویس‌ها**:
2. 
   - `kube-proxy` اطمینان می‌دهد که ترافیک ورودی به یک سرویس (Service) به پادهای مناسب هدایت می‌شود. در Kubernetes، سرویس‌ها به عنوان یک نقطه دسترسی واحد برای مجموعه‌ای از پادها عمل می‌کنند، و `kube-proxy` مسئول هدایت درخواست‌ها به پادهای پشت این سرویس‌ها است.

3. **قوانین IPTables یا IPVS**:
4. 
   - `kube-proxy` قوانین مسیریابی را در `iptables` (یا `IPVS` در نسخه‌های جدیدتر) تنظیم می‌کند تا ترافیک شبکه به درستی هدایت شود. این قوانین مشخص می‌کنند که وقتی ترافیکی به آدرس IP و پورت یک سرویس خاص وارد می‌شود، چگونه به یکی از پادهای مرتبط با آن سرویس هدایت شود.

5. **Load Balancing**:
6. 
   - `kube-proxy` از تکنیک‌های مختلفی برای توزیع بار (Load Balancing) بین پادها استفاده می‌کند. این توزیع بار به صورت پیش‌فرض به صورت round-robin انجام می‌شود، اما بسته به تنظیمات می‌توان از سایر روش‌ها نیز استفاده کرد.

### ارتباط `kube-proxy` با `kubelet`:

`kube-proxy` و `kubelet` هر دو در سطح نود عمل می‌کنند، اما وظایف متفاوتی دارند:

- **`kubelet`** مسئول مدیریت پادها و ارتباط آن‌ها با کنترل‌پلین Kubernetes است. این سرویس اطمینان می‌دهد که پادها به درستی در نود اجرا شده و وضعیت آن‌ها به `kube-apiserver` گزارش می‌شود.

- **`kube-proxy`** مسئول مسیریابی و مدیریت ترافیک شبکه است. این سرویس مستقیماً با پادها یا سرویس‌های درون نود تعامل ندارد، بلکه قوانین شبکه را تنظیم می‌کند تا ترافیک شبکه به درستی به پادها برسد.

### هماهنگی بین `kube-proxy` و `kubelet`:
- `kube-proxy` به صورت غیرمستقیم به اطلاعاتی که `kubelet` فراهم می‌کند وابسته است. به طور خاص، `kubelet` مطمئن می‌شود که پادها در حال اجرا هستند و به شبکه متصل می‌باشند. `kube-proxy` سپس از اطلاعات مربوط به سرویس‌ها و پادهای موجود استفاده می‌کند تا قوانین شبکه را تنظیم کند.
  
- اگر `kubelet` یک پاد جدید را راه‌اندازی کند، `kube-proxy` از طریق API Server مطلع می‌شود و قوانین شبکه جدیدی را برای هدایت ترافیک به این پاد تنظیم می‌کند.

به طور خلاصه، `kube-proxy` و `kubelet` به طور مستقل در نود کار می‌کنند اما با همکاری هم، شبکه و ارتباطات را در محیط Kubernetes بهینه می‌سازند.




این کامپوننت در کنار kubelete بالا میاد و وظیفه connectivity بین پاد به پاد و پاد به نود و ... را بر عهده دارد .


یکی از اجزای اصلی در معماری Kubernetes است و مسئول مدیریت ترافیک شبکه بین کانتینرها و نودها در یک کلاستر Kubernetes می‌باشد. وظیفه اصلی kube-proxy برقراری سرویس‌ها و مدیریت قوانین شبکه است تا ارتباط بین کانتینرها و دسترسی به سرویس‌ها را فراهم سازد.

عمده وظایف kube-proxy عبارتند از:

**برقراری خدمات (Services):** kube-proxy مسئول برقراری سرویس‌ها در کلاستر است. سرویس‌ها در Kubernetes یک منبع مستقل هستند که به یک مجموعه از پادها متصل می‌شوند و امکان دسترسی به آنها از بیرون کلاستر فراهم می‌کنند. kube-proxy این ارتباطات را برقرار می‌کند.

**لایه L4 Load Balancing:** kube-proxy برای سرویس‌ها لایه‌ی ۴ (لایه Transport) Load Balancer فراهم می‌کند. این به این معناست که بر اساس IP و پورت‌ها (TCP یا UDP) بار ترافیک بین پادها توزیع می‌شود.

**نقشه‌برداری (Endpoint Mapping):** kube-proxy نقشه‌برداری بین سرویس‌ها و پادهایی که آن سرویس را پیاده‌سازی می‌کنند، انجام می‌دهد. در واقع، مدیریت این نقشه بر اساس تغییرات در ReplicaSets یا Podها انجام می‌شود.

**Proxy Modeها:** kube-proxy به صورت پیش‌فرض در چندین حالت (Proxy Mode) عمل می‌کند، از جمله iptables، ipvs، و userspace. هر یک از این حالت‌ها باعث مدیریت ترافیک شبکه و ایجاد لایه Load Balancing می‌شوند.

**نقشه‌برداری بازگشتی (Reverse Mapping):** kube-proxy به کمک تغییرات در ReplicaSets و Podها نقشه‌برداری را به‌روزرسانی کرده و درخواست‌های ترافیک شبکه را به پادهای جدید منتقل می‌کند.

کلیدی برای درک بهتر kube-proxy این است که این اجزا از شبکه در Kubernetes باعث ایجاد یک لایهٔ شبکه مجازی می‌شوند که ارتباطات میان کانتینرها و خدمات را مدیریت می‌کند و برای توزیع ترافیک به صورت Load Balancer و همچنین امکان دسترسی به سرویس‌ها از خارج کلاستر کمک می‌کند.
